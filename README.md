# AI Text API

## Описание проекта

Данный проект представляет собой backend API для использования текстовых нейросетей, с поддержкой нескольких моделей и внутренней системой учета расхода токенов (кредитов). API предоставляет возможности для работы с нейросетями, стриминга ответов и управления балансом пользователей.

## Функциональные возможности
- **Аутентификация и авторизация:** поддержка регистрации и входа пользователей с доступом к нейросетям.
- **Поддержка нескольких моделей:** API позволяет работать с разными нейросетевыми моделями через единый интерфейс.
- **Система биллинга:** учёт использования токенов, списание кредитов, проверка и обновление баланса.
- **Стриминг ответов:** использование Server-Sent Events (SSE) для стриминга данных от нейросетей.
- **Swagger документация:** полная спецификация API с возможностью интерактивного тестирования.

## Технический стек
- **Node.js**
- **TypeScript**
- **Express** (HTTP библиотека)
- **PostgreSQL** (для хранения данных)
- **Server-Sent Events (SSE)** (для стриминга ответов)
- **Swagger/OpenAPI** (для документирования API)

## Установка

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/lutsenkosasha/AI-Text-API.git
   cd AI-Text-API

2. Установить зависимости:
    npm install

3. Создать файл .env:   
    DB_USER=your_db_user   
    DB_PASSWORD=your_db_password   
    DB_HOST=localhost   
    DB_PORT=5432   
    DB_NAME=ai_text_api   
    JWT_SECRET=your_jwt_secret   

4. Запустить приложение:
    npm run dev

## Документация API

Swagger UI доступен по адресу: `/api-docs`


## API эндпоинты
1. Аутентификация
   - **POST /auth/register: регистрация нового пользователя.**
   - **POST /auth/login: вход пользователя и получение JWT-токена.**

2. Модели нейросетей
   - **POST /api/v1/generate: отправка запроса на генерацию текста с помощью выбранной модели.**
   
3. Баланс
   - **GET /api/v1/balance: проверка баланса пользователя.**
   - **PUT /api/v1/balance: обновление баланса пользователя (для админов).**

4. Стриминг ответов
   - **GET /api/v1/stream: стриминг ответов от модели с использованием Server-Sent Events (SSE).**

## Swagger/OpenAPI спецификация
Проект использует спецификацию OpenAPI 3.0 для описания API. Файл спецификации находится в корневой директории проекта и автоматически используется для генерации документации Swagger.

## Система биллинга
Каждая модель нейросети использует токены для генерации текста. Внутренняя валюта (кредиты) используется для учёта расхода токенов. Баланс пользователя обновляется после каждой генерации, и он может стать отрицательным. Генерация запрещается при недостаточном балансе. Цена за токены зависит от выбранной модели:
- **GPT-4: 100 токенов = 20 кредитов**
- **Gemini-Flash: 100 токенов = 10 кредитов**   
